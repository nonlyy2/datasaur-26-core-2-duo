# ๐ฅ FIRE โ Freedom Intelligent Routing Engine

ะกะธััะตะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะพะน ะพะฑัะฐะฑะพัะบะธ ะธ ัะฐัะฟัะตะดะตะปะตะฝะธั ะบะปะธะตะฝััะบะธั ะพะฑัะฐัะตะฝะธะน ะดะปั **Freedom Broker Kazakhstan**.

---

## ะััะธัะตะบัััะฐ

```
tickets.csv + managers.csv + business_units.csv
        โ
        โผ
  โโโโโโโโโโโโโโโ     Gemini AI (batch)      โโโโโโโโโโโโโโโโโโโโ
  โ  main.go    โ โโโโโโโโโโโโโโโโโโโโโโโโโโบ โ  data/results.csvโ
  โ  (Go v6.0)  โ โโโ Nominatim geocoding    โโโโโโโโโโฌโโโโโโโโโโ
  โโโโโโโโโโโโโโโ                                     โ
                                                       โผ
                                            โโโโโโโโโโโโโโโโโโโโโโโโ
                                            โ   load_results.py    โ
                                            โ   (Django ORM)       โ
                                            โโโโโโโโโโฌโโโโโโโโโโโโโโ
                                                     โ
                                                     โผ
                                            โโโโโโโโโโโโโโโโโโโโโโโโ
                                            โ    PostgreSQL        โ
                                            โ  Ticket โ AI Result  โ
                                            โ     โ Manager        โ
                                            โโโโโโโโโโฌโโโโโโโโโโโโโโ
                                                     โ
                                                     โผ
                                            โโโโโโโโโโโโโโโโโโโโโโโโ
                                            โ     app.py           โ
                                            โ  (Streamlit UI)      โ
                                            โโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ะกัะตะบ ัะตัะฝะพะปะพะณะธะน

| ะะพะผะฟะพะฝะตะฝั | ะขะตัะฝะพะปะพะณะธั |
|-----------|-----------|
| AI-ะดะฒะธะถะพะบ | Go 1.22, Gemini 2.5 Flash API |
| AI-ะฐััะธััะตะฝั UI | Gemini 2.5 Flash (Star Task) |
| ะะตะฑ-ะธะฝัะตััะตะนั | Python, Streamlit |
| ะะดะผะธะฝะธัััะธัะพะฒะฐะฝะธะต | Django 5.x |
| ะะฐะทะฐ ะดะฐะฝะฝัั | PostgreSQL |
| ะะตะพะบะพะดะธัะพะฒะฐะฝะธะต | Nominatim (OpenStreetMap) + Haversine |
| ะะบััะถะตะฝะธะต | python-dotenv |

---

## ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั

### AI-ะฐะฝะฐะปะธะท ะบะฐะถะดะพะณะพ ัะธะบะตัะฐ (NLP)
- **ะขะธะฟ ะพะฑัะฐัะตะฝะธั**: ะะฐะปะพะฑะฐ / ะกะผะตะฝะฐ ะดะฐะฝะฝัั / ะะพะฝััะปััะฐัะธั / ะัะตัะตะฝะทะธั / ะะตัะฐะฑะพัะพัะฟะพัะพะฑะฝะพััั ะฟัะธะปะพะถะตะฝะธั / ะะพัะตะฝะฝะธัะตัะบะธะต ะดะตะนััะฒะธั / ะกะฟะฐะผ
- **ะขะพะฝะฐะปัะฝะพััั**: ะะพะทะธัะธะฒะฝัะน / ะะตะนััะฐะปัะฝัะน / ะะตะณะฐัะธะฒะฝัะน
- **ะัะธะพัะธัะตั**: 1โ10 (VIP/Priority ัะตะณะผะตะฝั โ ะฟัะธะฝัะดะธัะตะปัะฝะพ 10)
- **ะฏะทัะบ**: KZ / ENG / RU (ะฟะพ ัะผะพะปัะฐะฝะธั RU)
- **Summary**: ะบัะฐัะบะฐั ะฒัะถะธะผะบะฐ + ัะตะบะพะผะตะฝะดะฐัะธั ะผะตะฝะตะดะถะตัั (ะฝะฐ ัะทัะบะต ะพะฑัะฐัะตะฝะธั)
- **ะะตะพ-ะฝะพัะผะฐะปะธะทะฐัะธั**: Nominatim โ ะบะพะพัะดะธะฝะฐัั โ Haversine ะดะปั ัะฐััััะฐ ัะฐัััะพัะฝะธั ะดะพ ะพัะธัะพะฒ; LLM ะบะฐะบ fallback

### ะะพะณะธะบะฐ ัะฐัะฟัะตะดะตะปะตะฝะธั (ะบะฐัะบะฐะด ัะธะปัััะพะฒ)
1. **ะะตะพ-ัะธะปััั**: ะฑะปะธะถะฐะนัะธะน ะพัะธั ะฟะพ ะบะพะพัะดะธะฝะฐัะฐะผ ะบะปะธะตะฝัะฐ
   - ะะฝะพัััะฐะฝัั ะธะปะธ ะฝะตะธะทะฒะตััะฝัะน ะฐะดัะตั โ 50/50 ะััะฐะฝะฐ/ะะปะผะฐัั
2. **Hard Skills**:
   - VIP/Priority ัะตะณะผะตะฝั โ ัะพะปัะบะพ ะผะตะฝะตะดะถะตัั ั ะฝะฐะฒัะบะพะผ `VIP`
   - ะกะผะตะฝะฐ ะดะฐะฝะฝัั โ ัะพะปัะบะพ `ะะปะฐะฒะฝัะน ัะฟะตัะธะฐะปะธัั`
   - KZ/ENG ะพะฑัะฐัะตะฝะธะต โ ะผะตะฝะตะดะถะตั ั ัะพะพัะฒะตัััะฒัััะธะผ ัะทัะบะพะฒัะผ ะฝะฐะฒัะบะพะผ
3. **Round Robin**: ะฒัะฑะธัะฐัััั ัะพะฟ-2 ะผะตะฝะตะดะถะตัะฐ ั ะฝะฐะธะผะตะฝััะตะน ะฝะฐะณััะทะบะพะน, ัะตัะตะดะพะฒะฐะฝะธะต

### ะกะฟะฐะผ
ะกะฟะฐะผ-ัะธะบะตัั ัะพััะฐะฝััััั ะฒ ะฐะฝะฐะปะธัะธะบั, ะฝะพ ะผะตะฝะตะดะถะตั **ะฝะต ะฝะฐะทะฝะฐัะฐะตััั**.

### ะญัะบะฐะปะฐัะธั
ะัะปะธ ะฒ ัะตะปะตะฒะพะผ ะพัะธัะต ะฝะตั ะฟะพะดัะพะดััะตะณะพ ะผะตะฝะตะดะถะตัะฐ โ ัะธะบะตั ััะบะฐะปะธััะตััั ะฒ ะะ (ะััะฐะฝะฐ ะธะปะธ ะะปะผะฐัั).

---

## ะกัััะบัััะฐ ัะฐะนะปะพะฒ

```
fire_project/
โโโ main.go                  # Go AI-ะดะฒะธะถะพะบ: ะฐะฝะฐะปะธะท + ะณะตะพะบะพะดะธะฝะณ + ัะพััะธะฝะณ
โโโ app.py                   # Streamlit ะดะฐัะฑะพัะด + Star Task AI-ะฐััะธััะตะฝั
โโโ load_results.py          # ะะฐะณััะทะบะฐ results.csv โ PostgreSQL
โโโ load_data.py             # ะะฐะณััะทะบะฐ managers.csv + tickets.csv โ PostgreSQL
โโโ load_things.py           # ะะปััะตัะฝะฐัะธะฒะฝะฐั ะทะฐะณััะทะบะฐ ั ะฟะตัะตััััะพะผ ะฝะฐะณััะทะบะธ
โโโ reset_all.py             # ะะพะปะฝัะน ัะฑัะพั: DROP/CREATE DB + migrate + ะทะฐะณััะทะบะฐ
โโโ fire_project/            # Django-ะฟัะพะตะบั (settings, urls)
โโโ routing/
โ   โโโ models.py            # Ticket, Manager, BusinessUnit, RoutingResult
โ   โโโ migrations/          # Django-ะผะธะณัะฐัะธะธ (001โ007)
โโโ data/
    โโโ tickets.csv          # ะัะพะดะฝัะต ัะธะบะตัั
    โโโ managers.csv         # ะะตะฝะตะดะถะตัั
    โโโ business_units.csv   # ะัะธัั
    โโโ results.csv          # ะะตะทัะปััะฐัั AI-ัะพััะธะฝะณะฐ (ะณะตะฝะตัะธััะตััั Go)
    โโโ attachments/         # ะะปะพะถะตะฝะธั ะบ ัะธะบะตัะฐะผ (ะธะทะพะฑัะฐะถะตะฝะธั)
```

---

## ะัััััะน ััะฐัั

### 1. ะฃััะฐะฝะพะฒะธัั PostgreSQL

ะกะบะฐัะฐะนัะต ะธ ัััะฐะฝะพะฒะธัะต [PostgreSQL](https://www.postgresql.org/download/). ะฃะฑะตะดะธัะตัั, ััะพ ัะตัะฒะตั ะทะฐะฟััะตะฝ. ะะฐะทะฐ ะดะฐะฝะฝัั ัะพะทะดะฐัััั **ะฐะฒัะพะผะฐัะธัะตัะบะธ** ะฝะฐ ัะปะตะดัััะตะผ ัะฐะณะต.

### 2. ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั

ะกะพะทะดะฐะนัะต `.env` ะฒ ะบะพัะฝะต ะฟัะพะตะบัะฐ:

```env
GEMINI_API_KEY=your_key_here
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASS=your_password
DB_NAME=fire_db
```

### 3. ะะฐะฒะธัะธะผะพััะธ

```bash
pip install -r requirements.txt
go mod tidy
```

### 4. ะะฐะฟััะบ ะพะดะฝะพะน ะบะพะผะฐะฝะดะพะน

```bash
python start.py
```

ะกะบัะธะฟั ะฐะฒัะพะผะฐัะธัะตัะบะธ:
- ะกะพะทะดะฐัั ะฑะฐะทั ะดะฐะฝะฝัั `fire_db` (ะตัะปะธ ะฝะต ัััะตััะฒัะตั)
- ะัะธะผะตะฝัะตั Django-ะผะธะณัะฐัะธะธ
- ะะฐะณััะถะฐะตั ะพัะธัั โ ะผะตะฝะตะดะถะตัั โ ัะธะบะตัั ะธะท CSV
- ะะฐะฟััะบะฐะตั Streamlit ะดะฐัะฑะพัะด

### 5. ะะฐะฟััะบ AI-ะฐะฝะฐะปะธะทะฐ

ะ Streamlit ะฝะฐะถะผะธัะต ะบะฝะพะฟะบั **โถ ะะฐะฟัััะธัั ะฐะฝะฐะปะธะท** โ Go-ะดะฒะธะถะพะบ ะทะฐะฟัััะธััั, ะฟัะพะฐะฝะฐะปะธะทะธััะตั ัะธะบะตัั ะธ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะทะฐะณััะทะธั ัะตะทัะปััะฐัั ะฒ ะะ.

ะะปะธ ะฒัััะฝัั:
```bash
go run main.go
python load_results.py
```

---

### ะััะฝะพะน ะทะฐะฟััะบ (ะฟะพ ัะฐะณะฐะผ)

```bash
python manage.py migrate
python load_data.py
streamlit run app.py
```

### ะะพะปะฝัะน ัะฑัะพั (ัะธัััะน ััะฐัั)

```bash
python reset_all.py
```

ะฃะดะฐะปัะตั `data/results.csv`, ะฟะตัะตัะพะทะดะฐัั ะะ, ะฟัะธะผะตะฝัะตั ะผะธะณัะฐัะธะธ, ะทะฐะณััะถะฐะตั ะฒัะต ะดะฐะฝะฝัะต ะทะฐะฝะพะฒะพ.

---

## ะะฐัะฑะพัะด (Streamlit)

| ะะฐะทะดะตะป | ะะฟะธัะฐะฝะธะต |
|--------|----------|
| ะะฟะตัะฐัะธะฒะฝะฐั ัะฒะพะดะบะฐ | ะะตััะธะบะธ: ะฒัะตะณะพ ัะธะบะตัะพะฒ, VIP, ัะฟะฐะผ, ะฟัะตัะตะฝะทะธะธ/ััะพะด, ััะบะฐะปะฐัะธะธ |
| ะขะธะฟั ะพะฑัะฐัะตะฝะธะน | Bar chart ะฟะพ ัะธะฟะฐะผ |
| ะัะดะฐ ััะปะธ ัะธะบะตัั | ะะฐัะฟัะตะดะตะปะตะฝะธะต ะฟะพ ะพัะธัะฐะผ |
| ะฃัะพะฒะฝะธ ะฟัะธะพัะธัะตัะฐ | High / Medium / Low |
| ะะฐะณััะทะบะฐ ะฝะฐ ะผะตะฝะตะดะถะตัะพะฒ | ะะตะฐะปัะฝัะน `current_load` ะธะท PostgreSQL (ัะพะฟ-10) |
| ะขะพะฝะฐะปัะฝะพััั | ะะพะทะธัะธะฒะฝัะน / ะะตะนััะฐะปัะฝัะน / ะะตะณะฐัะธะฒะฝัะน |
| ะคะธะปัััั + ัะฐะฑะปะธัะฐ | ะคะธะปัััะฐัะธั ะฟะพ ัะธะฟั, ะฟัะธะพัะธัะตัั, ัะตะณะผะตะฝัั, ะพัะธัั |
| ะญัะบะฐะปะธัะพะฒะฐะฝะฝัะต ัะธะบะตัั | ะะฐัะบััะฒะฐะตะผัะน ัะฟะธัะพะบ |
| ะะปะพะถะตะฝะธั | ะัะพัะผะพัั ะธะทะพะฑัะฐะถะตะฝะธะน ะธะท `data/attachments/` |
| ๐ค Star Task | AI-ะฐััะธััะตะฝั: ะฒะพะฟัะพัั ะฝะฐ ะตััะตััะฒะตะฝะฝะพะผ ัะทัะบะต โ ะณัะฐัะธะบะธ |

---

## ะกัะตะผะฐ ะะ

```
BusinessUnit (routing_businessunit)
    โโโ Manager (routing_manager)  [FK โ BusinessUnit]

Ticket (routing_ticket)
    โโโ RoutingResult (routing_routingresult)  [OneToOne โ Ticket, FK โ Manager]
```

`RoutingResult` ััะฐะฝะธั ะฒัะต ัะตะทัะปััะฐัั AI-ะฐะฝะฐะปะธะทะฐ: ัะธะฟ, ัะพะฝะฐะปัะฝะพััั, ัะทัะบ, ะฟัะธะพัะธัะตั, summary, ะฒะปะพะถะตะฝะธั, ะฝะฐะทะฝะฐัะตะฝะฝัะน ะผะตะฝะตะดะถะตั, ะพัะธั, ะฟัะธัะธะฝั ัะพััะธะฝะณะฐ, ะผะตัะพะด ะณะตะพะบะพะดะธัะพะฒะฐะฝะธั, ัะปะฐะณ ััะบะฐะปะฐัะธะธ.

---

## ะกะพะพัะฒะตัััะฒะธะต ะขะ

| ะัะธัะตัะธะน | ะะตั | ะะตะฐะปะธะทะฐัะธั |
|----------|-----|-----------|
| ะะพะณะธะบะฐ ัะฐัะฟัะตะดะตะปะตะฝะธั | 40% | ะะฐัะบะฐะด: ะะตะพ โ VIP โ ะกะผะตะฝะฐ ะดะฐะฝะฝัั โ ะฏะทัะบ โ Round Robin |
| ะะฐัะตััะฒะพ AI-ะฐะฝะฐะปะธะทะฐ | 25% | Gemini 2.5 Flash + keyword fallback + Nominatim ะณะตะพะบะพะดะธะฝะณ |
| UI ะธ ะะธะทัะฐะปะธะทะฐัะธั | 20% | Streamlit ะดะฐัะฑะพัะด + Star Task AI-ะฐััะธััะตะฝั ั ัะฐััะฐะผะธ |
| ะััะธัะตะบัััะฐ | 15% | Go + Python + Django + PostgreSQL, ัะธัััะต ัะปะพะธ ะดะฐะฝะฝัั |
